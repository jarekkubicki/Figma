<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      html, body {
        margin: 0;
        padding: 0;
        width: 240px;
        height: auto;
        box-sizing: border-box;
        font-family: sans-serif;
        font-size: 13px;
        background: white;
        color: #111;
        overflow: hidden;
      }

      .container {
        padding: 16px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }

      .field {
        display: flex;
        align-items: center;
        justify-content: space-between;
        width: 100%;
        margin-bottom: 12px;
      }

      .field label {
        flex: 1;
      }

      .field input[type="number"],
      .field input[type="text"] {
        width: 80px;
        padding: 4px;
        font-size: 13px;
      }

      .color-picker {
        display: flex;
        align-items: center;
        gap: 6px;
        width: 100%;
      }

      .color-picker input[type="text"] {
        width: 60px;
      }

      .buttons {
        display: flex;
        flex-direction: column;
        gap: 6px;
        margin-top: 12px;
        width: 100%;
      }

      button {
        padding: 6px;
        font-size: 13px;
        border: none;
        background-color: #0064ff;
        color: white;
        border-radius: 4px;
        cursor: pointer;
        transition: background 0.2s;
      }

      button:hover {
        background-color: #004dcc;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="field">
        <label for="percent">Margin (%):</label>
        <input id="percent" type="number" min="1" max="49" value="10" />
      </div>

      <div class="field">
        <label for="opacity">Opacity (%):</label>
        <input id="opacity" type="number" min="1" max="100" value="30" />
      </div>

      <div class="color-picker">
        <label for="color">Color:</label>
        <input id="color" type="text" value="#00bfff" />
        <input id="picker" type="color" value="#00bfff" />
      </div>

      <div class="buttons">
        <button id="apply">Apply guidelines</button>
        <button id="remove">Remove guidelines</button>
        <button id="toggle">Toggle visibility</button>
      </div>
    </div>

    <script>
      const $ = (id) => document.getElementById(id);

      window.__guides_cache = window.__guides_cache || {
        percent: 10,
        opacity: 30,
        color: "#00bfff"
      };

      // Init values on load
      window.onload = () => {
        $("percent").value = window.__guides_cache.percent;
        $("opacity").value = window.__guides_cache.opacity;
        $("color").value = window.__guides_cache.color;
        $("picker").value = window.__guides_cache.color;
      };

      // Sync color picker <-> hex input
      $("color").addEventListener("input", () => {
        const val = $("color").value;
        if (/^#[0-9A-Fa-f]{6}$/.test(val)) $("picker").value = val;
      });

      $("picker").addEventListener("input", () => {
        $("color").value = $("picker").value;
      });

      function send(type) {
        const percent = parseFloat($("percent").value);
        const opacity = parseFloat($("opacity").value);
        const color = $("color").value;

        window.__guides_cache = { percent, opacity, color };

        parent.postMessage({ pluginMessage: { type, percent, opacity, color } }, "*");
      }

      $("apply").onclick = () => send("apply-guides");
      $("remove").onclick = () => send("remove-guides");
      $("toggle").onclick = () => send("toggle-guides");
    </script>
  </body>
</html>
