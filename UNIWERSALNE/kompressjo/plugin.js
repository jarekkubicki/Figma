var w=Object.defineProperty,L=(t,e,s)=>e in t?w(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,p=(t,e,s)=>(L(t,typeof e!="symbol"?e+"":e,s),s),M=(t,e,s)=>new Promise((n,i)=>{var r=l=>{try{a(s.next(l))}catch(d){i(d)}},o=l=>{try{a(s.throw(l))}catch(d){i(d)}},a=l=>l.done?n(l.value):Promise.resolve(l.value).then(r,o);a((s=s.apply(t,e)).next())}),m;(t=>{const e=new Map;function s(i,r){var o;return(o=e.get(i))==null?void 0:o.get(r)}t.getDelegate=s;function n(i,r,o){e.has(i)||e.set(i,new Map);const a=e.get(i);a.has(r)||a.set(r,o)}t.register=n})(m||(m={}));const u=class{constructor(t,e){this.name=t,this.definitions=e}static get current(){return u.currentSide}static set current(t){if(u.currentSide!=null)throw new Error("Logical side can be declared only once.");u.currentSide=t}static register(t){return this.sides.set(t.getName(),t),t}static byName(t){return this.sides.get(t)}getName(){return this.name}beginListening(t,e){const s=n=>{var i,r,o;if(this.definitions.shouldHandle!=null&&!this.definitions.shouldHandle(n))return;const a=(o=(r=(i=this.definitions).messageGetter)==null?void 0:r.call(i,n))!=null?o:n;if(a.type!=="response"){const l=t==null?void 0:t.byName(a.type);if(l==null)t!=null&&console.warn("Unknown message received ->",a.type);else{const d=u.byName(a.from),h=l.handle(a.payload,d);if(h!==void 0){const N=I=>{const P=u.current,v=m.getDelegate(P,d);v==null||v({from:u.current.getName(),type:"response",requestId:a.requestId,payload:I})};typeof(h==null?void 0:h.then)=="function"?h.then(N):N(h)}}}e!=null&&e(a)&&this.definitions.detachListener(s)};this.definitions.attachListener(s)}};let c=u;p(c,"currentSide"),p(c,"sides",new Map);function E(){const t=new Array(36);for(let e=0;e<36;e++)t[e]=Math.floor(Math.random()*16);return t[14]=4,t[19]=t[19]&=-5,t[19]=t[19]|=8,t[8]=t[13]=t[18]=t[23]="-",t.map(e=>e.toString(16)).join("")}class y{constructor(e){this.name=e}getName(){return this.name}createTransportMessage(e){const s=c.current;return{requestId:E(),type:this.getName(),from:s.getName(),payload:e}}sendTransportMessage(e){const s=c.current,n=this.receivingSide(),i=m.getDelegate(s,n);if(!i)throw new Error(`Transportation from ${s.getName()} to ${n.getName()} is not supported.`);return i(e),e}send(e){const s=this.createTransportMessage(e);return this.sendTransportMessage(s)}request(e){return M(this,null,function*(){const s=this.createTransportMessage(e),n=new Promise(i=>{c.current.beginListening(null,r=>r.requestId===s.requestId?(i(r.payload),!0):!1)});return this.sendTransportMessage(s),n})}}class T{constructor(){p(this,"registry",new Map)}byName(e){return this.registry.get(e)}register(e){return this.registry.set(e.getName(),e),e}}function S(t){return e=>{c.current=e,e.beginListening(t.messagesRegistry),t.initTransports(m.register)}}var g;(t=>{t.PLUGIN=c.register(new c("Plugin",{attachListener:e=>figma.ui.on("message",e),detachListener:e=>figma.ui.off("message",e)})),t.UI=c.register(new c("UI",{shouldHandle:e=>{var s;return((s=e.data)==null?void 0:s.pluginId)!=null},messageGetter:e=>e.data.pluginMessage,attachListener:e=>window.addEventListener("message",e),detachListener:e=>window.removeEventListener("message",e)}))})(g||(g={}));class b extends y{receivingSide(){return g.PLUGIN}async handle({id:e}){const s=figma.getNodeById(e);return s==null?void 0:s.exportAsync()}}class G extends y{receivingSide(){return g.PLUGIN}getPathFromParents(e){var i;const s=[];let n=e.parent;for(;(n==null?void 0:n.type)!=="PAGE";)s.push(n),n=(n==null?void 0:n.parent)||null;return(i=s.map(r=>r==null?void 0:r.name))==null?void 0:i.filter(r=>r==null?void 0:r.endsWith("/")).reverse().join("")}handle(){return figma.currentPage.selection.filter(s=>s.type==="FRAME"||s.type==="SECTION"||s.type==="COMPONENT"||s.type==="INSTANCE"||s.type==="GROUP"||s.type==="COMPONENT_SET").map(s=>{var n,i,r;return{id:s.id,name:s.name,path:this.getPathFromParents(s),compressionTarget:+("children"in s&&((r=(i=(n=s.children)==null?void 0:n.find(o=>o.name.startsWith("filesize_")))==null?void 0:i.name)==null?void 0:r.replace("filesize_",""))||"0")}})}}class U extends y{receivingSide(){return g.PLUGIN}handle(){figma.closePlugin()}}var f;(t=>{t.registry=new T,t.GET_SELECTION_META=t.registry.register(new G("get-selection-meta")),t.GET_BUFFER_FROM_NODE_ID=t.registry.register(new b("get-buffer-from-node-id")),t.CLOSE_PLUGIN=t.registry.register(new U("close-plugin"))})(f||(f={}));const _=S({messagesRegistry:f.registry,initTransports:function(t){t(g.PLUGIN,g.UI,e=>{figma.ui.postMessage(e)}),t(g.UI,g.PLUGIN,e=>{parent.postMessage({pluginMessage:e},"*")})}});async function O(){_(g.PLUGIN),figma.showUI(__html__,{width:800,height:800,title:"COMPRESSJO üßô‚Äç‚ôÇÔ∏è"})}O();
